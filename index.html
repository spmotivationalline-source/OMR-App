<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMR App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
        .app-container { width: 100%; max-width: 450px; margin: 1rem auto; display: flex; flex-direction: column; gap: 1rem; }
        .card { background: white; border-radius: 1.25rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); padding: 1rem; border: 1px solid #10B981; }
        .header-bar { background-color: #1E90FF; color: white; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: space-between; }
        .recent-exams-btn { border: 1px solid white; border-radius: 9999px; padding: 0.25rem 0.75rem; font-size: 0.8rem; font-weight: 600; cursor: pointer; }
        .hamburger-btn { cursor: pointer; }
        .stat-card { padding: 0.75rem; text-align: center; flex: 1; }
        .past-exam-card { padding: 1rem; border-bottom: 1px solid #e5e7eb; }
        .past-exam-card:last-child { border-bottom: none; }
        /* Modal and Side Menu Styles */
        .modal { transition: opacity 0.3s ease; }
        .side-menu { transition: transform 0.3s ease-in-out; }
        .recent-exam-item { cursor: pointer; padding: 0.75rem; border-radius: 0.5rem; }
        .recent-exam-item:hover { background-color: #f3f4f6; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="app-container">
        <header class="card header-bar">
            <div class="flex items-center">
                <div id="hamburger-btn" class="hamburger-btn space-y-1 mr-4"><div class="w-5 h-0.5 bg-white"></div><div class="w-5 h-0.5 bg-white"></div><div class="w-5 h-0.5 bg-white"></div></div>
                <h1 class="font-light text-xl">OMR App</h1>
            </div>
            <button id="recent-exams-btn" class="recent-exams-btn">RECENT Exams</button>
        </header>

        <!-- Past Results Card -->
        <div id="results-container" class="card">
            <div id="results-placeholder" class="h-24 flex items-center justify-center text-gray-400">
                <p>Your past exam results will show here.</p>
            </div>
            <div id="results-list" class="divide-y divide-gray-100"></div>
        </div>
        
        <!-- Chart Card (Placeholder) -->
        <div class="card flex-grow flex flex-col justify-between">
            <div class="flex-grow flex items-center justify-center text-gray-400">
                <p>Performance chart will be displayed here.</p>
            </div>
        </div>

        <!-- Average Stats Row -->
        <div class="flex space-x-2">
            <div class="card stat-card">
                <p id="avg-percentage" class="text-lg font-bold text-gray-800">0.0%</p>
                <p class="text-xs text-gray-500">Avg. Percentage</p>
            </div>
            <div class="card stat-card">
                <p id="avg-accuracy" class="text-lg font-bold text-gray-800">0.0%</p>
                <p class="text-xs text-gray-500">Avg. Accuracy</p>
            </div>
        </div>

        <a href="./create-omr.html" class="block text-center bg-[#1E90FF] text-white font-bold py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors flex-shrink-0">
            Start New Exam
        </a>
    </div>

    <!-- Side Menu (Hamburger Menu) -->
    <div id="side-menu" class="side-menu fixed top-0 left-0 h-full w-72 bg-white shadow-xl transform -translate-x-full z-50">
        <div class="p-5 border-b">
            <h2 class="text-2xl font-bold text-gray-800">OMR App Menu</h2>
        </div>
        <ul class="p-5 space-y-4 text-gray-700 font-semibold">
            <li class="hover:text-blue-600 cursor-pointer">Profile</li>
            <li class="hover:text-blue-600 cursor-pointer">Settings</li>
            <li class="hover:text-blue-600 cursor-pointer">About Us</li>
            <li class="hover:text-blue-600 cursor-pointer">Logout</li>
        </ul>
    </div>

    <!-- Recent Exams Modal -->
    <div id="recent-exams-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-lg max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-bold text-gray-800">Recent Exams History</h2>
                <button id="close-recent-modal-btn" class="text-3xl font-light text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="recent-exams-list" class="overflow-y-auto p-4 space-y-2">
                <!-- List JavaScript se aayegi -->
            </div>
        </div>
    </div>

    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Summary card ko populate karna
            const pastExams = JSON.parse(localStorage.getItem('pastExams')) || [];
            if (pastExams.length > 0) {
                document.getElementById('results-placeholder').style.display = 'none';
                const resultsList = document.getElementById('results-list');
                let totalPercentage = 0, totalAccuracy = 0;
                pastExams.forEach(exam => {
                    totalPercentage += parseFloat(exam.percentage);
                    totalAccuracy += parseFloat(exam.accuracy);
                    const examCard = document.createElement('div');
                    examCard.className = 'past-exam-card';
                    examCard.innerHTML = `<div class="flex justify-between items-center"><div><h3 class="font-bold text-gray-800">${exam.title}</h3><p class="text-sm text-gray-500">${exam.date}</p></div><div class="text-right"><p class="font-bold text-blue-600">${exam.score} / ${exam.totalScore}</p><p class="text-xs text-green-600">${exam.percentage}%</p></div></div>`;
                    resultsList.appendChild(examCard);
                });
                document.getElementById('avg-percentage').textContent = `${(totalPercentage / pastExams.length).toFixed(1)}%`;
                document.getElementById('avg-accuracy').textContent = `${(totalAccuracy / pastExams.length).toFixed(1)}%`;
            }

            // Modal aur Side Menu ke elements
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const recentExamsBtn = document.getElementById('recent-exams-btn');
            const sideMenu = document.getElementById('side-menu');
            const recentExamsModal = document.getElementById('recent-exams-modal');
            const closeRecentModalBtn = document.getElementById('close-recent-modal-btn');
            const overlay = document.getElementById('overlay');

            // Side Menu Kholna/Band karna
            hamburgerBtn.addEventListener('click', () => {
                overlay.classList.remove('hidden');
                sideMenu.classList.remove('-translate-x-full');
            });

            // Recent Exams Modal Kholna
            recentExamsBtn.addEventListener('click', () => {
                populateRecentExams();
                overlay.classList.remove('hidden');
                recentExamsModal.classList.remove('hidden');
            });

            // Band karne wale functions
            function closeAll() {
                overlay.classList.add('hidden');
                sideMenu.classList.add('-translate-x-full');
                recentExamsModal.classList.add('hidden');
            }

            closeRecentModalBtn.addEventListener('click', closeAll);
            overlay.addEventListener('click', closeAll);

            // Recent Exams ki list banana
            function populateRecentExams() {
                const fullHistory = JSON.parse(localStorage.getItem('fullExamHistory')) || [];
                const listContainer = document.getElementById('recent-exams-list');
                listContainer.innerHTML = ''; // Purani list saaf karo

                if (fullHistory.length === 0) {
                    listContainer.innerHTML = `<p class="text-center text-gray-500">No exam history found.</p>`;
                    return;
                }

                fullHistory.forEach(examData => {
                    const item = document.createElement('div');
                    item.className = 'recent-exam-item flex justify-between items-center';
                    item.innerHTML = `
                        <div>
                            <p class="font-bold text-gray-800">${examData.settings.title}</p>
                            <p class="text-sm text-gray-500">${new Date(examData.id).toLocaleString()}</p>
                        </div>
                        <span class="text-blue-500 font-semibold">View &rarr;</span>
                    `;
                    item.addEventListener('click', () => {
                        // Data ko current exam ke liye set karo aur analysis page par jao
                        localStorage.setItem('omrSettings', JSON.stringify(examData.settings));
                        localStorage.setItem('userAnswers', JSON.stringify(examData.userAnswers));
                        localStorage.setItem('correctAnswerKey', JSON.stringify(examData.answerKey));
                        window.location.href = './result-analysis.html';
                    });
                    listContainer.appendChild(item);
                });
            }
        });
    </script>
</body>
</html>

